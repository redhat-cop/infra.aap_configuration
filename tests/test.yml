---
- name: Playbook to configure ansible controller post installation
  hosts: localhost
  connection: local
  vars:
    workflow_job_templates_secure_logging: false
    controller_validate_certs: false
  collections:
    - awx.awx
    - infra.controller_configuration
  # Define following vars here, or in configs/controller_auth.yml
  # controller_hostname: controller.example.com
  # controller_username: admin
  # controller_password: changeme
  pre_tasks:

    - name: Include vars from controller_configs directory
      ansible.builtin.include_vars:
        dir: ./configs_export_model
        ignore_files: [README.md]
        extensions: ["yml"]


  tasks:

    - name: Install, configure, and start Apache
      block:
        - name: Export workflow job template
          infra.controller_configuration.controller_export_diff:
            credentials: all
            compare_items:
              #organizations: "{{ organizations }}"
              #projects: "{{ projects }}"
              #credential_types: "{{ credential_types }}"
              credentials: "{{ credentials }}"
              #inventory: "{{ inventory }}"
              #inventory_sources: "{{ inventory_sources }}"
              #notification_templates: "{{ notification_templates }}"
              #teams: "{{ teams }}"
              #users: "{{ users }}"
              #job_templates: "{{ job_templates }}"
            with_present: false
            controller_host: "{{ controller_hostname }}"
            controller_username: "{{ controller_username }}"
            controller_password: "{{ controller_password }}"
            validate_certs: "{{ controller_validate_certs }}"
          register: export_results

        - name: Export output
          ansible.builtin.debug:
            var: export_results.difference

        - name: "Assert that the expected results match for {{ differential_item.name }}"
          ansible.builtin.assert:
            that:
              - differential_expected ==  export_results.difference

...
